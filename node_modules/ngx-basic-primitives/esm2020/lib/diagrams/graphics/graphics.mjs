import { LineType, Layers, SegmentType } from '../../enums';
import { Rect, Size } from '../../structs';
import { Path } from './path';
import { Label } from './label';
import { Template } from './template';
import { Placeholder } from './placeholder';
import { Layer } from './layer';
export class Graphics {
    constructor(size) {
        this.placeholders = {};
        this.activePlaceholder = null;
        this.hasGraphics = true;
        this.names = [];
        this.size = size;
        this.names = [];
        for (var layer in Layers) {
            let value = parseInt(Layers[layer]);
            this.names[value] = layer;
        }
        ;
    }
    clean() {
        this.placeholders = {};
        this.activePlaceholder = null;
    }
    resize(name, width, height) {
        this.activatePlaceholder(name);
        this.resizePlaceholder(this.activePlaceholder, 0, 0, width, height);
    }
    ;
    position(name, left, top, width, height) {
        this.activatePlaceholder(name);
        this.resizePlaceholder(this.activePlaceholder, left, top, width, height);
    }
    ;
    show(name) {
        var placeholder = this.placeholders[name];
        if (placeholder != null) {
            placeholder.isVisible = true;
        }
    }
    ;
    hide(name) {
        var placeholder = this.placeholders[name];
        if (placeholder != null) {
            placeholder.isVisible = false;
        }
    }
    ;
    resizePlaceholder(placeholder, left, top, width, height) {
        placeholder.size = new Size(width, height);
        placeholder.rect = new Rect(left, top, width, height);
    }
    ;
    reset(placeholderName, layerKey) {
        const placeholder = this.placeholders[placeholderName];
        if (placeholder != null) {
            const layer = placeholder.layers[layerKey];
            if (layer != null) {
                layer.reset();
            }
        }
    }
    ;
    activate(placeholderName, layerKey) {
        this.activatePlaceholder(placeholderName);
        this.activateLayer(layerKey);
        return this.activePlaceholder;
    }
    ;
    activatePlaceholder(name) {
        let placeholder = this.placeholders[name];
        if (placeholder === undefined) {
            placeholder = new Placeholder(name);
            placeholder.size = this.size;
            placeholder.rect = new Rect(0, 0, placeholder.size.width, placeholder.size.height);
            this.placeholders[name] = placeholder;
        }
        this.activePlaceholder = placeholder;
    }
    ;
    activateLayer(layerKey) {
        const name = this.names[layerKey];
        if (!this.activePlaceholder) {
            throw "No active placeholder";
        }
        let layer = this.activePlaceholder.layers[layerKey];
        if (layer === undefined) {
            layer = new Layer(name);
            this.activePlaceholder.layers[layerKey] = layer;
        }
        this.activePlaceholder.activeLayer = layer;
    }
    ;
    getPlaceholders() {
        return this.placeholders;
    }
    text(x, y, width, height, label, orientation, horizontalAlignment, verticalAlignment, attr) {
        if (!this.activePlaceholder || !this.activePlaceholder.activeLayer) {
            throw "No active placeholder or layer";
        }
        this.activePlaceholder.activeLayer.labels.push(new Label(label, width, height, orientation, horizontalAlignment, verticalAlignment, {
            ...attr,
            top: y + "px",
            left: x + "px"
        }));
    }
    ;
    polyline(polylineData) {
        if (!this.activePlaceholder || !this.activePlaceholder.activeLayer) {
            throw "No active placeholder or layer";
        }
        var attr = polylineData.paletteItem.toAttr(), step, radius, cornerRadius, style = {};
        if (attr.fillColor !== undefined) {
            style.fill = attr.fillColor;
            style.fillOpacity = attr.opacity;
        }
        else {
            style.fillOpacity = 0;
        }
        if (attr.lineWidth !== undefined && attr.borderColor !== undefined) {
            style.stroke = attr.borderColor;
            style.strokeWidth = attr.lineWidth;
            if (attr.opacity !== undefined) {
                style.strokeOpacity = attr.opacity;
            }
            else {
                style.strokeOpacity = 1;
            }
        }
        else {
            style.stroke = "transparent";
            style.strokeWidth = 0;
        }
        if (attr.lineType != null) {
            step = Math.round(attr.lineWidth) || 1;
            switch (attr.lineType) {
                case LineType.Dotted:
                    style.strokeDasharray = step + "," + step;
                    break;
                case LineType.Dashed:
                    style.strokeDasharray = (step * 5) + "," + (step * 3);
                    break;
                case LineType.Solid:
                default:
                    style.strokeDasharray = "";
                    break;
            }
        }
        let data = "";
        polylineData.loop(this, function (segment) {
            switch (segment.segmentType) {
                case SegmentType.Move:
                    data += "M" + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y) + 0.5);
                    break;
                case SegmentType.Line:
                    data += "L" + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y) + 0.5);
                    break;
                case SegmentType.QuadraticArc:
                    data += "Q" + (Math.round(segment.cpX) + 0.5) + " " + (Math.round(segment.cpY) + 0.5) + " " + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y) + 0.5);
                    break;
                case SegmentType.Dot:
                    // A rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y
                    if (segment.width === segment.height && segment.width / 2.0 <= segment.cornerRadius) {
                        // dot
                        radius = segment.width / 2.0;
                        data += "M" + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y) + segment.height / 2.0 + 0.5);
                        data += "A" + radius + " " + radius + " 0 0 0 " + (Math.round(segment.x + segment.width) + 0.5) + " " + (Math.round(segment.y) + segment.height / 2.0 + 0.5);
                        data += "A" + radius + " " + radius + " 0 0 0 " + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y) + segment.height / 2.0 + 0.5);
                    }
                    else if (segment.cornerRadius === 0) {
                        // square
                        data += "M" + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y) + 0.5);
                        data += "L" + (Math.round(segment.x + segment.width) + 0.5) + " " + (Math.round(segment.y) + 0.5);
                        data += "L" + (Math.round(segment.x + segment.width) + 0.5) + " " + (Math.round(segment.y + segment.height) + 0.5);
                        data += "L" + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y + segment.height) + 0.5);
                        data += "L" + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y) + 0.5);
                    }
                    else {
                        cornerRadius = Math.min(segment.cornerRadius, Math.min(segment.width / 2.0, segment.height / 2.0));
                        data += "M" + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y + cornerRadius) + 0.5);
                        data += "A" + Math.round(cornerRadius) + " " + Math.round(cornerRadius) + " 0 0 1 " + (Math.round(segment.x + cornerRadius) + 0.5) + " " + (Math.round(segment.y) + 0.5);
                        data += "L" + (Math.round(segment.x + segment.width - cornerRadius) + 0.5) + " " + (Math.round(segment.y) + 0.5);
                        data += "A" + Math.round(cornerRadius) + " " + Math.round(cornerRadius) + " 0 0 1 " + (Math.round(segment.x + segment.width) + 0.5) + " " + (Math.round(segment.y + cornerRadius) + 0.5);
                        data += "L" + (Math.round(segment.x + segment.width) + 0.5) + " " + (Math.round(segment.y + segment.height - cornerRadius) + 0.5);
                        data += "A" + Math.round(cornerRadius) + " " + Math.round(cornerRadius) + " 0 0 1 " + (Math.round(segment.x + segment.width - cornerRadius) + 0.5) + " " + (Math.round(segment.y + segment.height) + 0.5);
                        data += "L" + (Math.round(segment.x + cornerRadius) + 0.5) + " " + (Math.round(segment.y + segment.height) + 0.5);
                        data += "A" + Math.round(cornerRadius) + " " + Math.round(cornerRadius) + " 0 0 1 " + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y + segment.height - cornerRadius) + 0.5);
                        data += "L" + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y + cornerRadius) + 0.5);
                    }
                    break;
                case SegmentType.CubicArc:
                    data += "C" + (Math.round(segment.cpX1) + 0.5) + " " + (Math.round(segment.cpY1) + 0.5) +
                        " " + (Math.round(segment.cpX2) + 0.5) + " " + (Math.round(segment.cpY2) + 0.5) +
                        " " + (Math.round(segment.x) + 0.5) + " " + (Math.round(segment.y) + 0.5);
                    break;
                default:
                    break;
            }
        });
        this.activePlaceholder.activeLayer.polylines.push(new Path(data, style));
    }
    ;
    polylinesBuffer(buffer) {
        var thisArg = this;
        buffer.loop(this, function (item) {
            if (item.length() > 0) {
                thisArg.polyline(item);
            }
        });
    }
    ;
    template(x, y, width, height, contentX, contentY, contentWidth, contentHeight, options, _hashCode, onRenderTemplate, uiHash, attr) {
        if (!this.activePlaceholder || !this.activePlaceholder.activeLayer) {
            throw "No active placeholder or layer";
        }
        const left = x + contentX, top = y + contentY, templateWidth = contentWidth, templateHeight = contentHeight;
        let style = {
            "width": templateWidth + "px",
            "height": templateHeight + "px",
            "top": top + "px",
            "left": left + "px",
            ...attr
        };
        var context = {
            ...uiHash,
            ...options,
            x: left,
            y: top,
            width: templateWidth,
            height: templateHeight
        };
        var templateRef = null;
        if (onRenderTemplate !== null) {
            templateRef = onRenderTemplate(context);
        }
        ;
        // if(options.templateType == "labelAnnotationTemplate") {
        //   console.log("template type:" + options.templateType);
        //   console.log(JSON.stringify(context));
        // }
        this.activePlaceholder.activeLayer.items.push(new Template(options.templateType, options.templateName, templateRef, context, style));
    }
    ;
    getPxSize(value, base) {
        var result = value;
        if (typeof value === "string") {
            if (value.indexOf("pt") > 0) {
                result = parseInt(value, 10) * 96 / 72;
            }
            else if (value.indexOf("%") > 0) {
                result = parseFloat(value) / 100.0 * base;
            }
            else {
                result = parseInt(value, 10);
            }
        }
        return result;
    }
    ;
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhcGhpY3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtYmFzaWMtcHJpbWl0aXZlcy9zcmMvbGliL2RpYWdyYW1zL2dyYXBoaWNzL2dyYXBoaWNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUM1RCxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzlCLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDaEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN0QyxPQUFPLEVBQUUsV0FBVyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFHaEMsTUFBTSxPQUFPLFFBQVE7SUFPakIsWUFBWSxJQUFVO1FBTnRCLGlCQUFZLEdBQStCLEVBQUUsQ0FBQztRQUM5QyxzQkFBaUIsR0FBdUIsSUFBSSxDQUFDO1FBQzdDLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ25CLFVBQUssR0FBa0IsRUFBRSxDQUFDO1FBSXRCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLEtBQUksSUFBSSxLQUFLLElBQUksTUFBTSxFQUFFO1lBQ3JCLElBQUksS0FBSyxHQUFVLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUMzQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLEtBQUssQ0FBQztTQUM3QjtRQUFBLENBQUM7SUFDTixDQUFDO0lBRUgsS0FBSztRQUNILElB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R0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7d0JBQ3pHLElBQUksSUFBSSxHQUFHLEdBQUcsTUFBTSxHQUFHLEdBQUcsR0FBRyxNQUFNLEdBQUcsU0FBUyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQzt3QkFDN0osSUFBSSxJQUFJLEdBQUcsR0FBRyxNQUFNLEdBQUcsR0FBRyxHQUFHLE1BQU0sR0FBRyxTQUFTLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztxQkFDOUk7eUJBQU0sSUFBSSxPQUFPLENBQUMsWUFBWSxLQUFLLENBQUMsRUFBRTt3QkFDckMsU0FBUzt3QkFDVCxJQUFJLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7d0JBQ2xGLElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3dCQUNsRyxJQUFJLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3dCQUNuSCxJQUFJLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQzt3QkFDbkcsSUFBSSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3FCQUNuRjt5QkFBTTt3QkFDTCxZQUFZLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxHQUFHLEVBQUUsT0FBTyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUNuRyxJQUFJLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3dCQUNqRyxJQUFJLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLEdBQUcsU0FBUyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3dCQUN6SyxJQUFJLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7d0JBQ2pILElBQUksSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxTQUFTLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQzt3QkFDekwsSUFBSSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLEdBQUcsWUFBWSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7d0JBQ2xJLElBQUksSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxTQUFTLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLEtBQUssR0FBRyxZQUFZLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3dCQUMxTSxJQUFJLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7d0JBQ2xILElBQUksSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxTQUFTLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sR0FBRyxZQUFZLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQzt3QkFDMUws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UUFDaEQsSUFBSSxnQkFBZ0IsS0FBSyxJQUFJLEVBQUU7WUFDN0IsV0FBVyxHQUFHLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ3pDO1FBQUEsQ0FBQztRQUNGLDBEQUEwRDtRQUMxRCwwREFBMEQ7UUFDMUQsMENBQTBDO1FBQzFDLElBQUk7UUFDSixJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxPQUFPLENBQUMsWUFBWSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUN2SSxDQUFDO0lBQUEsQ0FBQztJQUVGLFNBQVMsQ0FBQyxLQUFVLEVBQUUsSUFBWTtRQUNoQyxJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDN0IsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDM0IsTUFBTSxHQUFHLFFBQVEsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQzthQUN4QztpQkFDSSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUMvQixNQUFNLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUM7YUFDM0M7aUJBQ0k7Z0JBQ0gsTUFBTSxHQUFHLFFBQVEsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7YUFDOUI7U0FDRjtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFBQSxDQUFDO0NBQ0g7QUFBQSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTGluZVR5cGUsIExheWVycywgU2VnbWVudFR5cGUgfSBmcm9tICcuLi8uLi9lbnVtcyc7XHJcbmltcG9ydCB7IFJlY3QsIFNpemUgfSBmcm9tICcuLi8uLi9zdHJ1Y3RzJztcclxuaW1wb3J0IHsgSG9yaXpvbnRhbEFsaWdubWVudFR5cGUsIFRleHRPcmllbnRhdGlvblR5cGUsIFZlcnRpY2FsQWxpZ25tZW50VHlwZSB9IGZyb20gJy4uLy4uL2VudW1zJztcclxuaW1wb3J0IHsgUGF0aCB9IGZyb20gJy4vcGF0aCc7XHJcbmltcG9ydCB7IExhYmVsIH0gZnJvbSAnLi9sYWJlbCc7XHJcbmltcG9ydCB7IFRlbXBsYXRlIH0gZnJvbSAnLi90ZW1wbGF0ZSc7XHJcbmltcG9ydCB7IFBsYWNlaG9sZGVyfSBmcm9tICcuL3BsYWNlaG9sZGVyJztcclxuaW1wb3J0IHsgTGF5ZXIgfSBmcm9tICcuL2xheWVyJztcclxuaW1wb3J0IHsgVGVtcGxhdGVSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBHcmFwaGljcyB7XHJcbiAgICBwbGFjZWhvbGRlcnM6IHtbaWQ6IHN0cmluZ106UGxhY2Vob2xkZXJ9ID0ge307XHJcbiAgICBhY3RpdmVQbGFjZWhvbGRlcjogUGxhY2Vob2xkZXIgfCBudWxsID0gbnVsbDtcclxuICAgIGhhc0dyYXBoaWNzID0gdHJ1ZTtcclxuICAgIG5hbWVzOiBBcnJheTxzdHJpbmc+ID0gW107XHJcbiAgICBzaXplOiBTaXplO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHNpemU6IFNpemUpIHtcclxuICAgICAgICB0aGlzLnNpemUgPSBzaXplO1xyXG4gICAgICAgIHRoaXMubmFtZXMgPSBbXTtcclxuICAgICAgICBmb3IodmFyIGxheWVyIGluIExheWVycykge1xyXG4gICAgICAgICAgICBsZXQgdmFsdWU6bnVtYmVyID0gcGFyc2VJbnQoTGF5ZXJzW2xheWVyXSk7XHJcbiAgICAgICAgICAgIHRoaXMubmFtZXNbdmFsdWVdID0gbGF5ZXI7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgY2xlYW4oKSB7XHJcbiAgICB0aGlzLnBsYWNlaG9sZGVycyA9IHt9O1xyXG4gICAgdGhpcy5hY3RpdmVQbGFjZWhvbGRlciA9IG51bGw7XHJcbiAgfVxyXG5cclxuICByZXNpemUobmFtZTogc3RyaW5nLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xyXG4gICAgdGhpcy5hY3RpdmF0ZVBsYWNlaG9sZGVyKG5hbWUpO1xyXG4gICAgdGhpcy5yZXNpemVQbGFjZWhvbGRlcih0aGlzLmFjdGl2ZVBsYWNlaG9sZGVyISwgMCwgMCwgd2lkdGgsIGhlaWdodCk7XHJcbiAgfTtcclxuXHJcbiAgcG9zaXRpb24obmFtZTogc3RyaW5nLCBsZWZ0OiBudW1iZXIsIHRvcDogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xyXG4gICAgdGhpcy5hY3RpdmF0ZVBsYWNlaG9sZGVyKG5hbWUpO1xyXG4gICAgdGhpcy5yZXNpemVQbGFjZWhvbGRlcih0aGlzLmFjdGl2ZVBsYWNlaG9sZGVyISwgbGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0KTtcclxuICB9O1xyXG5cclxuICBzaG93KG5hbWU6IHN0cmluZykge1xyXG4gICAgdmFyIHBsYWNlaG9sZGVyID0gdGhpcy5wbGFjZWhvbGRlcnNbbmFtZV07XHJcbiAgICBpZiAocGxhY2Vob2xkZXIgIT0gbnVsbCkge1xyXG4gICAgICBwbGFjZWhvbGRlci5pc1Zpc2libGUgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGhpZGUobmFtZTogc3RyaW5nKSB7XHJcbiAgICB2YXIgcGxhY2Vob2xkZXIgPSB0aGlzLnBsYWNlaG9sZGVyc1tuYW1lXTtcclxuICAgIGlmIChwbGFjZWhvbGRlciAhPSBudWxsKSB7XHJcbiAgICAgIHBsYWNlaG9sZGVyLmlzVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHJlc2l6ZVBsYWNlaG9sZGVyKHBsYWNlaG9sZGVyOiBQbGFjZWhvbGRlciwgbGVmdDogbnVtYmVyLCB0b3A6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcclxuICAgIHBsYWNlaG9sZGVyLnNpemUgPSBuZXcgU2l6ZSh3aWR0aCwgaGVpZ2h0KTtcclxuICAgIHBsYWNlaG9sZGVyLnJlY3QgPSBuZXcgUmVjdChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpO1xyXG4gIH07XHJcblxyXG4gIHJlc2V0KHBsYWNlaG9sZGVyTmFtZTogc3RyaW5nLCBsYXllcktleTogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBwbGFjZWhvbGRlciA9IHRoaXMucGxhY2Vob2xkZXJzW3BsYWNlaG9sZGVyTmFtZV07XHJcbiAgICBpZiAocGxhY2Vob2xkZXIgIT0gbnVsbCkge1xyXG4gICAgICBjb25zdCBsYXllciA9IHBsYWNlaG9sZGVyLmxheWVyc1tsYXllcktleV07XHJcbiAgICAgIGlmIChsYXllciAhPSBudWxsKSB7XHJcbiAgICAgICAgbGF5ZXIucmVzZXQoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGFjdGl2YXRlKHBsYWNlaG9sZGVyTmFtZTogc3RyaW5nLCBsYXllcktleTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLmFjdGl2YXRlUGxhY2Vob2xkZXIocGxhY2Vob2xkZXJOYW1lKTtcclxuICAgIHRoaXMuYWN0aXZhdGVMYXllcihsYXllcktleSk7XHJcbiAgICByZXR1cm4gdGhpcy5hY3RpdmVQbGFjZWhvbGRlcjtcclxuICB9O1xyXG5cclxuICBhY3RpdmF0ZVBsYWNlaG9sZGVyKG5hbWU6IHN0cmluZykge1xyXG4gICAgbGV0IHBsYWNlaG9sZGVyID0gdGhpcy5wbGFjZWhvbGRlcnNbbmFtZV07XHJcblxyXG4gICAgaWYgKHBsYWNlaG9sZGVyID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgcGxhY2Vob2xkZXIgPSBuZXcgUGxhY2Vob2xkZXIobmFtZSk7XHJcbiAgICAgIHBsYWNlaG9sZGVyLnNpemUgPSB0aGlzLnNpemU7XHJcbiAgICAgIHBsYWNlaG9sZGVyLnJlY3QgPSBuZXcgUmVjdCgwLCAwLCBwbGFjZWhvbGRlci5zaXplLndpZHRoLCBwbGFjZWhvbGRlci5zaXplLmhlaWdodCk7XHJcbiAgICAgIHRoaXMucGxhY2Vob2xkZXJzW25hbWVdID0gcGxhY2Vob2xkZXI7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hY3RpdmVQbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyO1xyXG4gIH07XHJcblxyXG4gIGFjdGl2YXRlTGF5ZXIobGF5ZXJLZXk6IG51bWJlcikge1xyXG4gICAgY29uc3QgbmFtZSA9IHRoaXMubmFtZXNbbGF5ZXJLZXldO1xyXG4gICAgaWYoIXRoaXMuYWN0aXZlUGxhY2Vob2xkZXIpIHtcclxuICAgICAgdGhyb3cgXCJObyBhY3RpdmUgcGxhY2Vob2xkZXJcIjtcclxuICAgIH1cclxuICAgIGxldCBsYXllciA9IHRoaXMuYWN0aXZlUGxhY2Vob2xkZXIubGF5ZXJzW2xheWVyS2V5XTtcclxuXHJcbiAgICBpZiAobGF5ZXIgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBsYXllciA9IG5ldyBMYXllcihuYW1lKTtcclxuICAgICAgdGhpcy5hY3RpdmVQbGFjZWhvbGRlci5sYXllcnNbbGF5ZXJLZXldID0gbGF5ZXI7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hY3RpdmVQbGFjZWhvbGRlci5hY3RpdmVMYXllciA9IGxheWVyO1xyXG4gIH07XHJcblxyXG4gIGdldFBsYWNlaG9sZGVycygpIHtcclxuICAgIHJldHVybiB0aGlzLnBsYWNlaG9sZGVycztcclxuICB9XHJcblxyXG4gIHRleHQoeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBsYWJlbDogc3RyaW5nLCBvcmllbnRhdGlvbjogVGV4dE9yaWVudGF0aW9uVHlwZSwgaG9yaXpvbnRhbEFsaWdubWVudDogSG9yaXpvbnRhbEFsaWdubWVudFR5cGUsIHZlcnRpY2FsQWxpZ25tZW50OiBWZXJ0aWNhbEFsaWdubWVudFR5cGUsIGF0dHI6IE9iamVjdCkge1xyXG4gICAgaWYoIXRoaXMuYWN0aXZlUGxhY2Vob2xkZXIgfHwgIXRoaXMuYWN0aXZlUGxhY2Vob2xkZXIuYWN0aXZlTGF5ZXIpIHtcclxuICAgICAgdGhyb3cgXCJObyBhY3RpdmUgcGxhY2Vob2xkZXIgb3IgbGF5ZXJcIlxyXG4gICAgfVxyXG4gICAgdGhpcy5hY3RpdmVQbGFjZWhvbGRlci5hY3RpdmVMYXllci5sYWJlbHMucHVzaChcclxuICAgICAgbmV3IExhYmVsKGxhYmVsLCB3aWR0aCwgaGVpZ2h0LCBvcmllbnRhdGlvbiwgaG9yaXpvbnRhbEFsaWdubWVudCwgdmVydGljYWxBbGlnbm1lbnQsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgLi4uYXR0cixcclxuICAgICAgICAgIHRvcDogeSArIFwicHhcIixcclxuICAgICAgICAgIGxlZnQ6IHggKyBcInB4XCJcclxuICAgICAgICB9KVxyXG4gICAgKTtcclxuICB9O1xyXG5cclxuICBwb2x5bGluZShwb2x5bGluZURhdGE6IGFueSkge1xyXG4gICAgaWYoIXRoaXMuYWN0aXZlUGxhY2Vob2xkZXIgfHwgIXRoaXMuYWN0aXZlUGxhY2Vob2xkZXIuYWN0aXZlTGF5ZXIpIHtcclxuICAgICAgdGhyb3cgXCJObyBhY3RpdmUgcGxhY2Vob2xkZXIgb3IgbGF5ZXJcIlxyXG4gICAgfVxyXG5cclxuICAgIHZhciBhdHRyID0gcG9seWxpbmVEYXRhLnBhbGV0dGVJdGVtLnRvQXR0cigpLFxyXG4gICAgICBzdGVwLFxyXG4gICAgICByYWRpdXMsXHJcbiAgICAgIGNvcm5lclJhZGl1cyxcclxuICAgICAgc3R5bGU6IGFueSA9IHt9O1xyXG5cclxuXHJcbiAgICBpZiAoYXR0ci5maWxsQ29sb3IgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBzdHlsZS5maWxsID0gYXR0ci5maWxsQ29sb3I7XHJcbiAgICAgIHN0eWxlLmZpbGxPcGFjaXR5ID0gYXR0ci5vcGFjaXR5O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHN0eWxlLmZpbGxPcGFjaXR5ID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYXR0ci5saW5lV2lkdGggIT09IHVuZGVmaW5lZCAmJiBhdHRyLmJvcmRlckNvbG9yICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgc3R5bGUuc3Ryb2tlID0gYXR0ci5ib3JkZXJDb2xvcjtcclxuICAgICAgc3R5bGUuc3Ryb2tlV2lkdGggPSBhdHRyLmxpbmVXaWR0aDtcclxuXHJcbiAgICAgIGlmIChhdHRyLm9wYWNpdHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHN0eWxlLnN0cm9rZU9wYWNpdHkgPSBhdHRyLm9wYWNpdHk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc3R5bGUuc3Ryb2tlT3BhY2l0eSA9IDE7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHN0eWxlLnN0cm9rZSA9IFwidHJhbnNwYXJlbnRcIjtcclxuICAgICAgc3R5bGUuc3Ryb2tlV2lkdGggPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhdHRyLmxpbmVUeXBlICE9IG51bGwpIHtcclxuICAgICAgc3RlcCA9IE1hdGgucm91bmQoYXR0ci5saW5lV2lkdGgpIHx8IDE7XHJcbiAgICAgIHN3aXRjaCAoYXR0ci5saW5lVHlwZSkge1xyXG4gICAgICAgIGNhc2UgTGluZVR5cGUuRG90dGVkOlxyXG4gICAgICAgICAgc3R5bGUuc3Ryb2tlRGFzaGFycmF5ID0gc3RlcCArIFwiLFwiICsgc3RlcDtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgTGluZVR5cGUuRGFzaGVkOlxyXG4gICAgICAgICAgc3R5bGUuc3Ryb2tlRGFzaGFycmF5ID0gKHN0ZXAgKiA1KSArIFwiLFwiICsgKHN0ZXAgKiAzKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgTGluZVR5cGUuU29saWQ6XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIHN0eWxlLnN0cm9rZURhc2hhcnJheSA9IFwiXCI7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGxldCBkYXRhID0gXCJcIjtcclxuICAgIHBvbHlsaW5lRGF0YS5sb29wKHRoaXMsIGZ1bmN0aW9uIChzZWdtZW50OiBhbnkpIHtcclxuICAgICAgc3dpdGNoIChzZWdtZW50LnNlZ21lbnRUeXBlKSB7XHJcbiAgICAgICAgY2FzZSBTZWdtZW50VHlwZS5Nb3ZlOlxyXG4gICAgICAgICAgZGF0YSArPSBcIk1cIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueCkgKyAwLjUpICsgXCIgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LnkpICsgMC41KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgU2VnbWVudFR5cGUuTGluZTpcclxuICAgICAgICAgIGRhdGEgKz0gXCJMXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LngpICsgMC41KSArIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC55KSArIDAuNSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFNlZ21lbnRUeXBlLlF1YWRyYXRpY0FyYzpcclxuICAgICAgICAgIGRhdGEgKz0gXCJRXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LmNwWCkgKyAwLjUpICsgXCIgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LmNwWSkgKyAwLjUpICsgXCIgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LngpICsgMC41KSArIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC55KSArIDAuNSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFNlZ21lbnRUeXBlLkRvdDpcclxuICAgICAgICAgIC8vIEEgcngsIHJ5LCB4LWF4aXMtcm90YXRpb24sIGxhcmdlLWFyYy1mbGFnLCBzd2VlcC1mbGFnLCB4LCB5XHJcbiAgICAgICAgICBpZiAoc2VnbWVudC53aWR0aCA9PT0gc2VnbWVudC5oZWlnaHQgJiYgc2VnbWVudC53aWR0aCAvIDIuMCA8PSBzZWdtZW50LmNvcm5lclJhZGl1cykge1xyXG4gICAgICAgICAgICAvLyBkb3RcclxuICAgICAgICAgICAgcmFkaXVzID0gc2VnbWVudC53aWR0aCAvIDIuMDtcclxuICAgICAgICAgICAgZGF0YSArPSBcIk1cIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueCkgKyAwLjUpICsgXCIgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LnkpICsgc2VnbWVudC5oZWlnaHQgLyAyLjAgKyAwLjUpO1xyXG4gICAgICAgICAgICBkYXRhICs9IFwiQVwiICsgcmFkaXVzICsgXCIgXCIgKyByYWRpdXMgKyBcIiAwIDAgMCBcIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueCArIHNlZ21lbnQud2lkdGgpICsgMC41KSArIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC55KSArIHNlZ21lbnQuaGVpZ2h0IC8gMi4wICsgMC41KTtcclxuICAgICAgICAgICAgZGF0YSArPSBcIkFcIiArIHJhZGl1cyArIFwiIFwiICsgcmFkaXVzICsgXCIgMCAwIDAgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LngpICsgMC41KSArIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC55KSArIHNlZ21lbnQuaGVpZ2h0IC8gMi4wICsgMC41KTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoc2VnbWVudC5jb3JuZXJSYWRpdXMgPT09IDApIHtcclxuICAgICAgICAgICAgLy8gc3F1YXJlXHJcbiAgICAgICAgICAgIGRhdGEgKz0gXCJNXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LngpICsgMC41KSArIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC55KSArIDAuNSk7XHJcbiAgICAgICAgICAgIGRhdGEgKz0gXCJMXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LnggKyBzZWdtZW50LndpZHRoKSArIDAuNSkgKyBcIiBcIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueSkgKyAwLjUpO1xyXG4gICAgICAgICAgICBkYXRhICs9IFwiTFwiICsgKE1hdGgucm91bmQoc2VnbWVudC54ICsgc2VnbWVudC53aWR0aCkgKyAwLjUpICsgXCIgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LnkgKyBzZWdtZW50LmhlaWdodCkgKyAwLjUpO1xyXG4gICAgICAgICAgICBkYXRhICs9IFwiTFwiICsgKE1hdGgucm91bmQoc2VnbWVudC54KSArIDAuNSkgKyBcIiBcIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueSArIHNlZ21lbnQuaGVpZ2h0KSArIDAuNSk7XHJcbiAgICAgICAgICAgIGRhdGEgKz0gXCJMXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LngpICsgMC41KSArIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC55KSArIDAuNSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb3JuZXJSYWRpdXMgPSBNYXRoLm1pbihzZWdtZW50LmNvcm5lclJhZGl1cywgTWF0aC5taW4oc2VnbWVudC53aWR0aCAvIDIuMCwgc2VnbWVudC5oZWlnaHQgLyAyLjApKTtcclxuICAgICAgICAgICAgZGF0YSArPSBcIk1cIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueCkgKyAwLjUpICsgXCIgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LnkgKyBjb3JuZXJSYWRpdXMpICsgMC41KTtcclxuICAgICAgICAgICAgZGF0YSArPSBcIkFcIiArIE1hdGgucm91bmQoY29ybmVyUmFkaXVzKSArIFwiIFwiICsgTWF0aC5yb3VuZChjb3JuZXJSYWRpdXMpICsgXCIgMCAwIDEgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LnggKyBjb3JuZXJSYWRpdXMpICsgMC41KSArIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC55KSArIDAuNSk7XHJcbiAgICAgICAgICAgIGRhdGEgKz0gXCJMXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LnggKyBzZWdtZW50LndpZHRoIC0gY29ybmVyUmFkaXVzKSArIDAuNSkgKyBcIiBcIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueSkgKyAwLjUpO1xyXG4gICAgICAgICAgICBkYXRhICs9IFwiQVwiICsgTWF0aC5yb3VuZChjb3JuZXJSYWRpdXMpICsgXCIgXCIgKyBNYXRoLnJvdW5kKGNvcm5lclJhZGl1cykgKyBcIiAwIDAgMSBcIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueCArIHNlZ21lbnQud2lkdGgpICsgMC41KSArIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC55ICsgY29ybmVyUmFkaXVzKSArIDAuNSk7XHJcbiAgICAgICAgICAgIGRhdGEgKz0gXCJMXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LnggKyBzZWdtZW50LndpZHRoKSArIDAuNSkgKyBcIiBcIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueSArIHNlZ21lbnQuaGVpZ2h0IC0gY29ybmVyUmFkaXVzKSArIDAuNSk7XHJcbiAgICAgICAgICAgIGRhdGEgKz0gXCJBXCIgKyBNYXRoLnJvdW5kKGNvcm5lclJhZGl1cykgKyBcIiBcIiArIE1hdGgucm91bmQoY29ybmVyUmFkaXVzKSArIFwiIDAgMCAxIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC54ICsgc2VnbWVudC53aWR0aCAtIGNvcm5lclJhZGl1cykgKyAwLjUpICsgXCIgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LnkgKyBzZWdtZW50LmhlaWdodCkgKyAwLjUpO1xyXG4gICAgICAgICAgICBkYXRhICs9IFwiTFwiICsgKE1hdGgucm91bmQoc2VnbWVudC54ICsgY29ybmVyUmFkaXVzKSArIDAuNSkgKyBcIiBcIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueSArIHNlZ21lbnQuaGVpZ2h0KSArIDAuNSk7XHJcbiAgICAgICAgICAgIGRhdGEgKz0gXCJBXCIgKyBNYXRoLnJvdW5kKGNvcm5lclJhZGl1cykgKyBcIiBcIiArIE1hdGgucm91bmQoY29ybmVyUmFkaXVzKSArIFwiIDAgMCAxIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC54KSArIDAuNSkgKyBcIiBcIiArIChNYXRoLnJvdW5kKHNlZ21lbnQueSArIHNlZ21lbnQuaGVpZ2h0IC0gY29ybmVyUmFkaXVzKSArIDAuNSk7XHJcbiAgICAgICAgICAgIGRhdGEgKz0gXCJMXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LngpICsgMC41KSArIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC55ICsgY29ybmVyUmFkaXVzKSArIDAuNSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFNlZ21lbnRUeXBlLkN1YmljQXJjOlxyXG4gICAgICAgICAgZGF0YSArPSBcIkNcIiArIChNYXRoLnJvdW5kKHNlZ21lbnQuY3BYMSkgKyAwLjUpICsgXCIgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LmNwWTEpICsgMC41KSArXHJcbiAgICAgICAgICAgIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC5jcFgyKSArIDAuNSkgKyBcIiBcIiArIChNYXRoLnJvdW5kKHNlZ21lbnQuY3BZMikgKyAwLjUpICtcclxuICAgICAgICAgICAgXCIgXCIgKyAoTWF0aC5yb3VuZChzZWdtZW50LngpICsgMC41KSArIFwiIFwiICsgKE1hdGgucm91bmQoc2VnbWVudC55KSArIDAuNSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5hY3RpdmVQbGFjZWhvbGRlci5hY3RpdmVMYXllci5wb2x5bGluZXMucHVzaChuZXcgUGF0aChkYXRhLCBzdHlsZSkpO1xyXG4gIH07XHJcblxyXG4gIHBvbHlsaW5lc0J1ZmZlcihidWZmZXI6IGFueSkge1xyXG4gICAgdmFyIHRoaXNBcmcgPSB0aGlzO1xyXG4gICAgYnVmZmVyLmxvb3AodGhpcywgZnVuY3Rpb24gKGl0ZW06IGFueSkge1xyXG4gICAgICBpZiAoaXRlbS5sZW5ndGgoKSA+IDApIHtcclxuICAgICAgICB0aGlzQXJnLnBvbHlsaW5lKGl0ZW0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICB0ZW1wbGF0ZSh4OiBudW1iZXIsIHk6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIGNvbnRlbnRYOiBudW1iZXIsIGNvbnRlbnRZOiBudW1iZXIsIGNvbnRlbnRXaWR0aDogbnVtYmVyLCBjb250ZW50SGVpZ2h0OiBudW1iZXIsIG9wdGlvbnM6IGFueSwgX2hhc2hDb2RlOiBzdHJpbmcsIG9uUmVuZGVyVGVtcGxhdGU6IChkYXRhOiBhbnkpID0+IFRlbXBsYXRlUmVmPGFueT4gfCBudWxsLCB1aUhhc2g6IE9iamVjdCwgYXR0cjogT2JqZWN0KSB7XHJcbiAgICBpZighdGhpcy5hY3RpdmVQbGFjZWhvbGRlciB8fCAhdGhpcy5hY3RpdmVQbGFjZWhvbGRlci5hY3RpdmVMYXllcikge1xyXG4gICAgICB0aHJvdyBcIk5vIGFjdGl2ZSBwbGFjZWhvbGRlciBvciBsYXllclwiXHJcbiAgICB9XHJcbiAgICBjb25zdCBsZWZ0ID0geCArIGNvbnRlbnRYLFxyXG4gICAgICB0b3AgPSB5ICsgY29udGVudFksXHJcbiAgICAgIHRlbXBsYXRlV2lkdGggPSBjb250ZW50V2lkdGgsXHJcbiAgICAgIHRlbXBsYXRlSGVpZ2h0ID0gY29udGVudEhlaWdodDtcclxuXHJcbiAgICBsZXQgc3R5bGUgPSB7XHJcbiAgICAgIFwid2lkdGhcIjogdGVtcGxhdGVXaWR0aCArIFwicHhcIixcclxuICAgICAgXCJoZWlnaHRcIjogdGVtcGxhdGVIZWlnaHQgKyBcInB4XCIsXHJcbiAgICAgIFwidG9wXCI6IHRvcCArIFwicHhcIixcclxuICAgICAgXCJsZWZ0XCI6IGxlZnQgKyBcInB4XCIsXHJcbiAgICAgIC4uLmF0dHJcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGNvbnRleHQgPSB7XHJcbiAgICAgIC4uLnVpSGFzaCxcclxuICAgICAgLi4ub3B0aW9ucyxcclxuICAgICAgeDogbGVmdCxcclxuICAgICAgeTogdG9wLFxyXG4gICAgICB3aWR0aDogdGVtcGxhdGVXaWR0aCxcclxuICAgICAgaGVpZ2h0OiB0ZW1wbGF0ZUhlaWdodFxyXG4gICAgfVxyXG5cclxuICAgIHZhciB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55PiB8IG51bGwgPSBudWxsO1xyXG4gICAgaWYgKG9uUmVuZGVyVGVtcGxhdGUgIT09IG51bGwpIHtcclxuICAgICAgdGVtcGxhdGVSZWYgPSBvblJlbmRlclRlbXBsYXRlKGNvbnRleHQpO1xyXG4gICAgfTtcclxuICAgIC8vIGlmKG9wdGlvbnMudGVtcGxhdGVUeXBlID09IFwibGFiZWxBbm5vdGF0aW9uVGVtcGxhdGVcIikge1xyXG4gICAgLy8gICBjb25zb2xlLmxvZyhcInRlbXBsYXRlIHR5cGU6XCIgKyBvcHRpb25zLnRlbXBsYXRlVHlwZSk7XHJcbiAgICAvLyAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KGNvbnRleHQpKTtcclxuICAgIC8vIH1cclxuICAgIHRoaXMuYWN0aXZlUGxhY2Vob2xkZXIuYWN0aXZlTGF5ZXIuaXRlbXMucHVzaChuZXcgVGVtcGxhdGUob3B0aW9ucy50ZW1wbGF0ZVR5cGUsIG9wdGlvbnMudGVtcGxhdGVOYW1lLCB0ZW1wbGF0ZVJlZiwgY29udGV4dCwgc3R5bGUpKTtcclxuICB9O1xyXG5cclxuICBnZXRQeFNpemUodmFsdWU6IGFueSwgYmFzZTogbnVtYmVyKSB7XHJcbiAgICB2YXIgcmVzdWx0ID0gdmFsdWU7XHJcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgIGlmICh2YWx1ZS5pbmRleE9mKFwicHRcIikgPiAwKSB7XHJcbiAgICAgICAgcmVzdWx0ID0gcGFyc2VJbnQodmFsdWUsIDEwKSAqIDk2IC8gNzI7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSBpZiAodmFsdWUuaW5kZXhPZihcIiVcIikgPiAwKSB7XHJcbiAgICAgICAgcmVzdWx0ID0gcGFyc2VGbG9hdCh2YWx1ZSkgLyAxMDAuMCAqIGJhc2U7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmVzdWx0ID0gcGFyc2VJbnQodmFsdWUsIDEwKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9O1xyXG59O1xyXG4iXX0=